<!doctype html>
<html lang="en">

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <link rel="icon" type="image/x-icon" href="favicon.ico">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link rel="stylesheet" href="css/owl.carousel.min.css">
    <link rel="stylesheet" href="css/owl.theme.default.min.css">
    <link rel='stylesheet' href='css/boxicons.min.css'>
    <link rel="stylesheet" href="css/style.css">
    <link rel=”stylesheet” href=”https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.0.1/css/bootstrap.min.css” />

    <!-- Icon Font Stylesheet -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.10.0/css/all.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.4.1/font/bootstrap-icons.css" rel="stylesheet">

    <title>Club Atletismo Santiago</title>
</head>

<body data-bs-spy="scroll" data-bs-target=".navbar">

    <!-- TOP NAV -->
    <div class="top-nav" id="home">
        <div class="container px-4">
            <div class="row justify-content-between">
                <div class="col-auto">
                    <p> <i class='bx bxs-envelope'></i> atletismosantiago@gmail.com</p>
                    <p> <i class='bx bxs-phone-call'></i> +34 666666666</p>
                </div>
                <div class="col-auto social-icons">
                    <a href="#"><i class='bx bxl-facebook'></i></a>
                    <a href="#"><i class='bx bxl-twitter'></i></a>
                    <a href="#"><i class='bx bxl-instagram'></i></a>
                    <a href="#"><i class='bx bxl-pinterest'></i></a>
                </div>
            </div>
        </div>
    </div>



    <nav class="navbar navbar-expand-lg navbar-light bg-white sticky-top" id="barraNavegacion">
        <div class="container px-4">
            <a class="navbar-brand" href="./index.html" style="max-width: 40%">
                <img src="./img/logo.png" alt="Club Atletismo Santiago Logo" style="max-width: 50%; height: auto;">
            </a>
            <button class="navbar-toggler navbar-toggler-right" type="button" data-bs-toggle="collapse"
                data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false"
                aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto my-2 my-lg-0 ">
                    <li nav-item>
                        <a href="./index.html" class="nav-link">Inicio</a>
                    </li>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="" id="destinosDropdown" role="button"
                            data-toggle="dropdown" data-bs-toggle="dropdown" aria-expanded="false">
                            Club
                        </a>
                        <ul class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
                            <li><a class="dropdown-item" href="./historia.html">Historia</a></li>
                            <li><a class="dropdown-item" href="https://swimburger-cas-app-demo.web.app/forms/licencia">Licencias</a></li>
                        </ul>
                    </li>
                    <li class="nav-item">
                        <a href="./calendario.html" class="nav-link">Calendario</a>
                    </li>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="" id="destinosDropdown" role="button"
                            data-toggle="dropdown" data-bs-toggle="dropdown" aria-expanded="false">
                            Estadísticas                            
                        </a>
                        <ul class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
                            <li><a class="dropdown-item" href="./records_club.html">Récords del Club</a></li>
                            <li><a class="dropdown-item" href="./estadisticas_atleta.html">Estadísticas Atletas</a></li>
                        </ul>
                    </li>
                    <li class="nav-item">
                        <a href="./patrocinadores.html" class="nav-link ">Patrocinadores</a>
                    </li>
                    <li class="nav-item">
                        <a href="./contacto.html" class="nav-link ">Contacto</a>
                    </li>

                </ul>
            </div>
        </div>

    </nav>

    <div class="container mt-5 py-1">
        <div class="container">
            <div class="text-center pb-1 wow fadeInUp" data-wow-delay="0.1s">
                <h5 class="text-primary-gradient fw-medium">ESTADÍSTICAS</h5>
                <h1 class="mb-1">Estadísticas de Nuestros Atletas</h1>
                <p class="mt-3 mb-0">A continuación, podrás obtener las marcas de nuestros atletas en las diferentes
                    pruebas
                    y temporadas.
                    <br><strong>IMPORTANTE: Solo se mostrarán aquellas que se realizaron mientras el atleta pertenecía
                        al club.</strong>
                    <br>El único campo obligatorio es el de "Temporada".
                </p>
                <hr class="divider" />
                <br>
            </div>

        </div>

        <div class="container">
            <div class="row justify-content-center text-center d-flex align-items-center mt-0">
                <form id="consultaForm" class="col-md-8">
                    <div class="row">
                        <div class="col-md-3">
                            <label for="nombre">Nombre:</label>
                            <select id="nombre" class="form-control" required></select>
                        </div>
                        <div class="col-md-3">
                            <label for="apellido">Apellido:</label>
                            <select id="apellido" class="form-control" required></select>
                        </div>

                        <div class="col-md-3">
                            <label for="temporada">Temporada:</label>
                            <select id="temporada" class="form-control" required>
                                <!-- Opciones de temporadas -->
                            </select>
                        </div>
                        <div class="col-md-3">
                            <label for="tipoPrueba">Prueba:</label>
                            <select id="tipoPrueba" class="form-control" required>
                                <!-- Opciones de tipos de prueba -->
                            </select>
                        </div>
                    </div>

                    <button type="button" onclick="consultarMarcas()" class="btn btn-primary mt-3">Consultar
                        Marcas</button>
                </form>
                <style>
                    .table-wrapper {
                        width: 100%;
                        overflow: auto;
                    }

                    .table-wrapper table {
                        border-collapse: separate;
                        border-spacing: 0;
                    }


                    .table-wrapper table th,
                    .table-wrapper table td {
                        border: 1px solid #000;
                        background-color: #FFF;
                    }
                </style>

                <div class="col-md-8 mt-3 table-wrapper">
                    <table id="resultados" class="table">
                        <!-- Aquí se mostrarán los resultados de la consulta -->
                    </table>
                </div>
            </div>
        </div>
    </div>










    <!-- Footer-->
    <footer class="bg-light py-5 mt-5">

        <div class="container">
            <div class="row">
                <div class="col-6 col-md-3 mb-3">
                    <h5>Atletismo Santiago</h5>
                    <ul class="nav flex-column">
                        <li class="nav-item mb-2"><a href="./index.html" class="nav-link p-0 text-muted">Inicio</a></li>
                        <li class="nav-item mb-2"><a href="" class="nav-link p-0 text-muted">Club</a></li>
                        <li class="nav-item mb-2"><a href="./calendario.html"
                                class="nav-link p-0 text-muted">Calendario</a></li>
                        <li class="nav-item mb-2"><a href="" class="nav-link p-0 text-muted">Estadisticas</a></li>
                        <li class="nav-item mb-2"><a href="./patrocinadores.html"
                                class="nav-link p-0 text-muted">Patrocinadores</a></li>
                        <li class="nav-item mb-2"><a href="./contacto.html" class="nav-link p-0 text-muted">Contacto</a>
                        </li>

                    </ul>
                </div>
                <div class="col-6 col-md-3 mb-3">
                    <h5>Club</h5>
                    <ul class="nav flex-column">
                        <li class="nav-item mb-2"><a href="./historia.html" class="nav-link p-0 text-muted">Historia</a>
                        </li>

                        <li class="nav-item mb-2"><a href="https://swimburger-cas-app-demo.web.app/forms/licencia"
                                class="nav-link p-0 text-muted">Inscripciones</a></li>

                    </ul>
                    <br>
                    <h5>Estadísticas</h5>
                    <ul class="nav flex-column">
                        <li class="nav-item mb-2"><a href="./records_club.html" class="nav-link p-0 text-muted">Récords
                                del Club</a></li>

                        <li class="nav-item mb-2"><a href="./estadisticas_atleta.html"
                                class="nav-link p-0 text-muted">Estadisticas Atletas</a></li>

                    </ul>
                </div>
                <div class="col-md-5 offset-md-1 mb-3">
                    <form>
                        <h5>Contacto</h5>
                        <p>Si tienes alguna pregunta no dudes en ponerte en contacto con nosotros</p>
                        <div class="d-flex flex-column flex-sm-row w-100 gap-2">
                            <label for="newsletter1" class="visually-hidden">Correo electrónico</label>
                            <input id="email" type="text" class="form-control" placeholder="Correo electrónico">
                            <label for="subject" class="visually-hidden">Asunto</label>
                            <input id="subject" type="text" class="form-control" placeholder="Asunto">

                        </div>
                        <div class="d-flex flex-column flex-sm-row w-100 gap-2 mt-2">
                            <label for="message" class="visually-hidden">Mensaje</label>
                            <textarea id="message" type="text" class="form-control" placeholder="Mensaje"></textarea>
                        </div>
                        <div
                            class="d-flex flex-column flex-sm-row w-100 mt-2 text-center justify-content-center align-items-center">
                            <button class="btn btn-primary" type="button" onclick="sendEmail()">Enviar</button>
                        </div>


                    </form>

                </div>
            </div>
            <div class="d-flex flex-column flex-sm-row justify-content-between border-top">
                <p>&copy; 2023 Reservados todos los derechos. <a
                        href="https://www.linkedin.com/in/%C3%B3scar-toimil-plaza/" style="color:#5e5b5b"
                        target="_blank" rel="noopener noreferrer">Ó. Toimil</a>. &copy;</p>
                <ul class="list-unstyled d-flex">
                    <li class="ms-4"><a class="bi bi-instagram link-dark"
                            href="https://www.instagram.com/atletismosantiago/?hl=es"></a></li>
                    <li class="ms-4"><a class="bi bi-facebook link-dark"
                            href="https://www.facebook.com/clubatletismo.santiago/?locale=es_ES"></svg></a></li>
                </ul>
            </div>


        </div>
    </footer>





    <script src="js/jquery.min.js"></script>
    <script src="js/popper.min.js"></script>
    <script src="js/bootstrap.bundle.min.js"></script>
    <script src="js/owl.carousel.min.js"></script>
    <script src="js/app.js"></script>
    <script src="js/tooltip.min.js"></script>

    <script>
        const form = document.getElementById('consultaForm');
        const resultadosTabla = document.getElementById('resultados');

        // Llenar las opciones de temporadas y tipos de prueba en el formulario
        const temporadaSelect = document.getElementById('temporada');
        const tipoPruebaSelect = document.getElementById('tipoPrueba');
        const nombreSelect = document.getElementById('nombre');
        const apellidoSelect = document.getElementById('apellido');

        // Rellenar opciones de temporadas y tipos de prueba desde los datos obtenidos
        fetch('https://toimil.github.io/AtletismoSantiago/data/output.json')
            .then(response => response.json())
            .then(datos => {
                const temporadas = Array.from(new Set(datos.map(item => item.Temporada)));
                const tiposPrueba = Array.from(new Set(datos.map(item => item.Title)));
                // Obtener nombres y apellidos únicos
                const atletasSet = new Set();

                datos.forEach(item => {
                    if (item.Data && Array.isArray(item.Data)) {
                        item.Data.forEach(dataItem => {
                            if (dataItem.Atleta && dataItem.Atleta.Nombre) {
                                atletasSet.add(dataItem.Atleta.Nombre);
                            }
                        });
                    }
                });
                const atletas = Array.from(atletasSet).sort(); // Convertir el Set a un array y ordenar alfabéticamente


                // Dentro del bloque que llena las opciones de apellidos
                const atletasApellidosSet = new Set();

                datos.forEach(item => {
                    if (item.Data && Array.isArray(item.Data)) {
                        item.Data.forEach(dataItem => {
                            if (dataItem.Atleta && dataItem.Atleta.Apellido) {
                                atletasApellidosSet.add(dataItem.Atleta.Apellido);
                            }
                        });
                    }
                });
                const atletasApellidos = Array.from(atletasApellidosSet).sort(); // Convertir el Set a un array y ordenar alfabéticamente


                // Añadir una opción vacía al selector de tipo de prueba
                const optionTipoPrueba = document.createElement('option');
                optionTipoPrueba.value = '';
                optionTipoPrueba.text = '---';
                tipoPruebaSelect.add(optionTipoPrueba);

                // Añadir una opción vacía al nombre
                const optionNombre = document.createElement('option');
                optionNombre.value = '';
                optionNombre.text = '---';
                nombreSelect.add(optionNombre);

                // Añadir una opción vacía al apellido
                const optionApellido = document.createElement('option');
                optionApellido.value = '';
                optionApellido.text = '---';
                apellidoSelect.add(optionApellido);

                temporadas.forEach(temporada => {
                    const option = document.createElement('option');
                    option.text = temporada;
                    temporadaSelect.add(option);
                });

                tiposPrueba.forEach(tipoPrueba => {
                    const option = document.createElement('option');
                    option.text = tipoPrueba;
                    tipoPruebaSelect.add(option);
                });

                // Dentro del bloque que llena las opciones de nombres
                atletas.forEach(atleta => {
                    const option = document.createElement('option');
                    option.text = atleta;
                    nombreSelect.add(option);
                });

                // Dentro del bloque que llena las opciones de apellidos
                atletasApellidos.forEach(atleta => {
                    const option = document.createElement('option');
                    option.text = atleta;
                    apellidoSelect.add(option);
                });

            })
            .catch(error => console.error('Error al obtener los datos:', error));


        function generarTabla(datos) {
            const resultadosTabla = document.getElementById('resultados');
            resultadosTabla.innerHTML = '';  // Limpiar el contenido anterior

            //si no hay datos, mostrar mensaje
            if (datos.length === 0) {
                const mensaje = document.createElement('p');
                mensaje.textContent = 'No se encontraron resultados';
                resultadosTabla.appendChild(mensaje);
                return;
            }



            // Crear encabezados de tabla
            const encabezados = ['Temporada', 'Tipo', 'Prueba', 'Marca', 'Nombre', 'Apellido', 'Fecha', 'Lugar'];
            const encabezadoRow = document.createElement('tr');
            encabezados.forEach(encabezado => {
                const th = document.createElement('th');
                th.textContent = encabezado;
                encabezadoRow.appendChild(th);
            });
            resultadosTabla.appendChild(encabezadoRow);

            // Llenar la tabla con datos
            datos.forEach(item => {
                item.Data.forEach(dataItem => {
                    const fila = document.createElement('tr');

                    const { Temporada, TipoPrueba, NombrePrueba } = item;
                    const { Marca, Atleta, Data, Lugar } = dataItem;
                    const { Nombre, Apellido } = Atleta;

                    const celdas = [Temporada, TipoPrueba, NombrePrueba, Marca, Nombre, Apellido, Data, Lugar];
                    celdas.forEach(valor => {
                        const td = document.createElement('td');
                        td.textContent = valor;
                        fila.appendChild(td);
                    });
                    resultadosTabla.appendChild(fila);
                });
            });


        }


        function consultarMarcas() {
            const nombre = nombreSelect.value;
            const apellido = apellidoSelect.value;
            const temporada = temporadaSelect.value;
            const tipoPrueba = tipoPruebaSelect.value;

            // Realizar la solicitud Fetch para obtener los datos desde la URL
            fetch('https://toimil.github.io/AtletismoSantiago/data/output.json')
                .then(response => response.json())
                .then(datos => {
                    const datosFiltrados = datos.filter(item =>
                        item.Temporada === temporada &&
                        (!tipoPrueba || item.Title === tipoPrueba)
                    );

                    const resultadosFiltrados = [];

                    datosFiltrados.forEach(item => {
                        if (item.Data && Array.isArray(item.Data)) {
                            item.Data.forEach(dataItem => {
                                if ((!nombre || dataItem.Atleta.Nombre === nombre) &&
                                    (!apellido || dataItem.Atleta.Apellido === apellido)) {

                                    // Buscar si ya existe una entrada para esta prueba
                                    const resultadoExistente = resultadosFiltrados.find(resultado =>
                                        resultado.TipoPrueba === item.Title &&
                                        resultado.NombrePrueba === item.Title
                                    );

                                    if (resultadoExistente) {
                                        // Agregar el atleta a la lista existente
                                        resultadoExistente.Data.push(dataItem);
                                    } else {
                                        // Crear un nuevo objeto para la prueba y agregar el atleta
                                        const resultadoAtleta = {
                                            Temporada: item.Temporada,
                                            TipoPrueba: item.TipoPrueba,
                                            NombrePrueba: item.Title,
                                            Genero: item.Genero,
                                            Data: [dataItem]
                                        };
                                        resultadosFiltrados.push(resultadoAtleta);
                                    }
                                }
                            });
                        }
                    });

                    // Mostrar los resultados en la tabla
                    generarTabla(resultadosFiltrados);
                })
                .catch(error => console.error('Error al obtener los datos:', error));
        }


    </script>


</body>

</html>